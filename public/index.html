<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Filter - VN30 Tracker (Matrix View)</title>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.5.1/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css" rel="stylesheet">
    <style>
        [v-cloak] {
            display: none;
        }

        .stock-symbol {
            font-weight: 600;
            font-size: 1.05em;
            font-family: 'Courier New', monospace;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .stock-symbol:hover {
            color: #1976D2;
        }

        .vn30-icon {
            color: #4CAF50;
            font-size: 1em;
        }

        .vn100-icon {
            color: #2196F3;
            font-size: 1em;
        }

        .matrix-cell {
            text-align: center;
            padding: 4px;
        }

        .status-new {
            color: #4CAF50;
            font-weight: bold;
        }

        .status-normal {
            color: #2196F3;
        }

        .status-removed {
            color: #9E9E9E;
            text-decoration: line-through;
        }

        .status-absent {
            color: #E0E0E0;
        }

        .date-header {
            font-weight: 600;
            font-size: 0.8em;
            white-space: nowrap;
            writing-mode: horizontal-tb;
        }

        .legend-item {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-right: 16px;
            font-size: 0.9em;
        }

        .price-cell {
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            text-align: center;
        }

        .change-positive {
            color: #4CAF50;
            font-weight: 600;
        }

        .change-negative {
            color: #F44336;
            font-weight: 600;
        }

        .change-neutral {
            color: #FFA726;
            font-weight: 600;
        }

        /* HIGH Warning Pulse Animation */
        .pulse-animation {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.15);
                opacity: 0.85;
            }
        }
    </style>
</head>

<body>
    <div id="app" v-cloak>
        <v-app>
            <v-app-bar color="primary" density="compact">
                <v-app-bar-title>
                    <v-icon icon="mdi-chart-line" class="mr-2"></v-icon>
                    Stock Filter - Matrix View
                </v-app-bar-title>
                <v-spacer></v-spacer>
                <!-- Analysis Progress -->
                <div v-if="autoAnalyzing" class="mr-4" style="display: flex; align-items: center; gap: 8px;">
                    <v-progress-circular indeterminate size="20" width="2" color="white"></v-progress-circular>
                    <span style="font-size: 0.9em;">
                        Ph√¢n t√≠ch: {{ analyzingProgress.completed }}/{{ analyzingProgress.total }}
                    </span>
                </div>
                <v-btn icon="mdi-chart-box-outline" @click="autoAnalyzeAll" :loading="autoAnalyzing" variant="text"
                    title="Ph√¢n t√≠ch t·∫•t c·∫£"></v-btn>
                <v-btn icon="mdi-cash-sync" @click="loadPrices(true)" :loading="loadingPrices" variant="text"
                    title="Refresh Prices"></v-btn>
                <v-btn icon="mdi-file-import" @click="processRawData" :loading="processing" variant="text"
                    title="Process raw.json"></v-btn>
                <v-btn icon="mdi-refresh" @click="loadData" :loading="loading" variant="text" title="Reload"></v-btn>
            </v-app-bar>

            <v-main>
                <v-container fluid>
                    <!-- Disclaimer Banner -->
                    <v-alert type="info" variant="tonal" density="compact" class="mb-3" icon="mdi-information">
                        <strong>L∆∞u √Ω quan tr·ªçng:</strong> Tool n√†y CH·ªà cung c·∫•p th√¥ng tin ph√¢n t√≠ch k·ªπ thu·∫≠t v·ªÅ Moving
                        Average, KH√îNG ph·∫£i l·ªùi khuy√™n ƒë·∫ßu t∆∞.
                        Ng∆∞·ªùi d√πng t·ª± ch·ªãu tr√°ch nhi·ªám v·ªÅ quy·∫øt ƒë·ªãnh giao d·ªãch c·ªßa m√¨nh.
                    </v-alert>

                    <!-- Matrix Table -->
                    <v-card>
                        <v-card-title>
                            L·ªãch s·ª≠ {{ matrixData.stats.totalDates || 0 }} ng√†y g·∫ßn nh·∫•t
                        </v-card-title>

                        <!-- Exchange Filter Tabs -->
                        <v-tabs v-model="selectedExchange" density="compact" class="px-4">
                            <v-tab value="FILTERED">Filtered</v-tab>
                            <v-tab value="HOSE">HOSE</v-tab>
                            <v-tab value="HNX">HNX</v-tab>
                            <v-tab value="VN30">VN30</v-tab>
                            <v-tab value="VN100">VN100</v-tab>
                        </v-tabs>

                        <v-data-table :headers="matrixHeaders" :items="matrixData.symbols || []" :items-per-page="100"
                            class="elevation-1" density="compact" :search="search">
                            <template v-slot:top>
                                <v-text-field v-model="search" label="T√¨m ki·∫øm m√£" prepend-inner-icon="mdi-magnify"
                                    variant="outlined" hide-details single-line class="ma-4"
                                    density="compact"></v-text-field>
                            </template>

                            <!-- Custom Header for Price Column with Stats -->
                            <template v-slot:header.price>
                                <div style="text-align: center; line-height: 1.2;">
                                    <div v-if="priceStats.total > 0">
                                        <span style="font-weight: 600; color: #4CAF50;">{{
                                            priceStats.up }}‚ñ≤</span>
                                        <span style="font-weight: 600; color: #FFA726;">{{
                                            priceStats.neutral }}‚àí</span>
                                        <span style="font-weight: 600; color: #F44336;">{{
                                            priceStats.down }}‚ñº</span>
                                    </div>
                                    <div style="color: #666;">({{ priceStats.total }} m√£)</div>
                                </div>
                            </template>

                            <!-- Custom Date Headers -->
                            <template v-for="(date, index) in matrixData.dates" :key="`header-${index}`"
                                v-slot:[`header.day${index}`]>
                                <div style="text-align: center; line-height: 1.2;">
                                    <div>{{ date.dateFormatted }}</div>
                                    <div style="color: #666;">({{ date.vn30Count }}/{{ date.count }})
                                    </div>
                                </div>
                            </template>

                            <!-- Symbol Column with Analyze Button -->
                            <template v-slot:item.symbol="{ item }">
                                <div style="display: flex; gap: 6px;">
                                    <a :href="item.tradingViewUrl" target="_blank" class="stock-symbol"
                                        style="text-decoration: none; color: inherit; display: flex;">
                                        {{ item.symbol }}
                                        <v-chip v-if="item.exchange" size="x-small"
                                            :color="item.exchange === 'HOSE' ? 'blue' : 'orange'" variant="flat"
                                            style="margin-left: 4px; font-size: 0.7em; height: 16px;">
                                            {{ item.exchange }}
                                        </v-chip>
                                        <v-icon v-if="item.isVN30" icon="mdi-star" class="vn30-icon"
                                            title="VN30"></v-icon>
                                        <v-icon v-if="item.isVN100" icon="mdi-star-outline" class="vn100-icon"
                                            title="VN100"></v-icon>
                                    </a>
                                    <v-btn icon size="x-small" variant="text" @click.stop="fetchPrice(item)"
                                        :loading="item.fetchingPrice" :color="item.price ? 'success' : 'primary'"
                                        density="compact">
                                        <v-icon icon="mdi-cash-sync" size="small"></v-icon>
                                        <v-tooltip activator="parent" location="top">
                                            {{ getPriceButtonTooltip(item) }}
                                        </v-tooltip>
                                    </v-btn>
                                </div>
                            </template>

                            <!-- Price Change Column -->
                            <template v-slot:item.price="{ item }">
                                <div class="price-cell" :class="getChangeClass(item.changePercent)">
                                    {{ formatPriceChange(item.price, item.changePercent) }}
                                </div>
                            </template>

                            <!-- Date Columns -->
                            <template v-for="(date, index) in matrixData.dates" :key="date.date"
                                v-slot:[`item.day${index}`]="{ item }">
                                <div class="matrix-cell">
                                    <v-icon v-if="item.days[index].status === 'new'" icon="mdi-checkbox-marked-circle"
                                        class="status-new" title="M·ªõi"></v-icon>
                                    <v-icon v-else-if="item.days[index].status === 'normal'" icon="mdi-checkbox-marked"
                                        class="status-normal" title="B√¨nh th∆∞·ªùng"></v-icon>
                                    <v-icon v-else-if="item.days[index].status === 'removed'" icon="mdi-close-circle"
                                        class="status-removed" title="S·∫Øp lo·∫°i"></v-icon>
                                    <v-icon v-else icon="mdi-minus" class="status-absent" title="Kh√¥ng c√≥"></v-icon>
                                </div>
                            </template>

                            <!-- Perfect Order Column -->
                            <template v-slot:item.perfect_order="{ item }">
                                <v-tooltip v-if="item.analysis?.current_state?.details?.perfect_order !== undefined"
                                    location="top">
                                    <template v-slot:activator="{ props }">
                                        <v-icon v-bind="props" v-if="item.analysis.current_state.details.perfect_order"
                                            icon="mdi-check-circle" color="success" size="small"></v-icon>
                                        <v-icon v-bind="props" v-else icon="mdi-close-circle" color="grey"
                                            size="small"></v-icon>
                                    </template>
                                    <div style="max-width: 250px;">
                                        <div v-if="item.analysis.current_state.details.perfect_order">
                                            <strong>‚úÖ Perfect Order</strong><br>
                                            MA10 > MA20 > MA50
                                        </div>
                                        <div v-else>
                                            <strong>V·ªã tr√≠ gi√°:</strong><br>
                                            vs MA50: {{
                                            item.analysis.current_state.details.price_position?.vs_ma50?.toFixed(1)
                                            }}%<br>
                                            vs MA20: {{
                                            item.analysis.current_state.details.price_position?.vs_ma20?.toFixed(1)
                                            }}%<br>
                                            vs MA10: {{
                                            item.analysis.current_state.details.price_position?.vs_ma10?.toFixed(1) }}%
                                        </div>
                                    </div>
                                </v-tooltip>
                                <span v-else style="color: #999;">-</span>
                            </template>

                            <!-- MA Signals Column - Factual signals only (NO advice) -->
                            <template v-slot:item.ma_signals="{ item }">
                                <div v-if="item.analysis?.current_state?.ma_signals?.length > 0"
                                    style="display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; max-width: 180px;">
                                    <!-- Display factual MA signals from backend -->
                                    <v-tooltip v-for="signal in item.analysis.current_state.ma_signals"
                                        :key="signal.type" location="top">
                                        <template v-slot:activator="{ props }">
                                            <v-chip v-bind="props" :color="signal.color" size="small"
                                                :prepend-icon="signal.icon" variant="flat" style="font-size: 0.75em;">
                                                {{ signal.label }}
                                            </v-chip>
                                        </template>
                                        <div v-html="signal.tooltip" style="max-width: 350px;"></div>
                                    </v-tooltip>
                                </div>
                                <span v-else style="color: #999;">-</span>
                            </template>
                        </v-data-table>
                    </v-card>

                    <v-overlay :model-value="loading" class="align-center justify-center">
                        <v-progress-circular indeterminate size="64" color="primary"></v-progress-circular>
                    </v-overlay>

                    <v-snackbar v-model="errorSnackbar" color="error" timeout="5000">
                        {{ errorMessage }}
                        <template v-slot:actions>
                            <v-btn variant="text" @click="errorSnackbar = false">ƒê√≥ng</v-btn>
                        </template>
                    </v-snackbar>
                </v-container>
            </v-main>
        </v-app>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.4.15/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.5.1/dist/vuetify.min.js"></script>
    <script>
        const { createApp } = Vue;
        const { createVuetify } = Vuetify;

        const vuetify = createVuetify({
            theme: {
                defaultTheme: 'light',
                themes: {
                    light: {
                        colors: {
                            primary: '#1976D2',
                            secondary: '#424242',
                            accent: '#82B1FF',
                            error: '#FF5252',
                            info: '#2196F3',
                            success: '#4CAF50',
                            warning: '#FFC107',
                        },
                    },
                },
            },
        });

        const app = createApp({
            data() {
                return {
                    loading: false,
                    loadingPrices: false,
                    processing: false,
                    selectedExchange: 'FILTERED',
                    matrixData: {
                        dates: [],
                        symbols: [],
                        stats: {}
                    },
                    search: '',
                    errorSnackbar: false,
                    errorMessage: '',
                    // Auto-analysis queue
                    analyzingQueue: [],
                    analyzingProgress: { completed: 0, total: 0 },
                    maxConcurrent: 5,
                    autoAnalyzing: false
                };
            },
            computed: {
                priceStats() {
                    if (!this.matrixData || !this.matrixData.symbols) {
                        return { up: 0, down: 0, neutral: 0, total: 0 };
                    }

                    let up = 0, down = 0, neutral = 0;

                    this.matrixData.symbols.forEach(symbol => {
                        if (symbol.changePercent !== null && symbol.changePercent !== undefined) {
                            if (symbol.changePercent > 0) {
                                up++;
                            } else if (symbol.changePercent < 0) {
                                down++;
                            } else {
                                neutral++;
                            }
                        }
                    });

                    return {
                        up,
                        down,
                        neutral,
                        total: up + down + neutral
                    };
                },
                matrixHeaders() {
                    const headers = [
                        {
                            title: 'M√£ CK',
                            key: 'symbol',
                            align: 'start',
                            sortable: true,
                            width: '120px'
                        },
                        {
                            title: 'Gi√°',
                            key: 'price',
                            align: 'end',
                            sortable: true,
                            width: '120px'
                        },
                        // MA Signals - Factual data only (NO advice)
                        {
                            title: 'Perfect Order',
                            key: 'perfect_order',
                            align: 'center',
                            sortable: true,
                            width: '70px'
                        },
                        {
                            title: 'MA Signals',
                            key: 'ma_signals',
                            align: 'center',
                            sortable: false,
                            width: '150px'
                        },
                    ];

                    // Add date columns
                    this.matrixData.dates.forEach((date, index) => {
                        headers.push({
                            title: date.dateFormatted,
                            key: `day${index}`,
                            align: 'center',
                            sortable: false,
                            width: '120px'
                        });
                    });

                    return headers;
                }
            },
            mounted() {
                this.loadData().then(() => {
                    this.autoAnalyzeAll();
                });
            },
            watch: {
                selectedExchange() {
                    this.loadData().then(() => {
                        this.autoAnalyzeAll();
                    });
                }
            },
            methods: {
                formatPriceChange(price, changePercent) {
                    if (price === null || price === undefined) return '-';
                    // Price is already in thousands (e.g., 23.55 = 23,550 VND)
                    const priceFormatted = price.toFixed(2);
                    if (changePercent === null || changePercent === undefined) {
                        return `${priceFormatted}`;
                    }
                    const sign = changePercent > 0 ? '+' : '';
                    const percent = Math.abs(changePercent) < 10 ? changePercent.toFixed(1) : Math.round(changePercent);

                    // Add triangle icon
                    let icon = '';
                    if (changePercent > 0) {
                        icon = '‚ñ≤ ';
                    } else if (changePercent < 0) {
                        icon = '‚ñº ';
                    } else {
                        icon = '‚àí ';
                    }

                    return `${icon}${priceFormatted} (${sign}${percent}%)`;
                },
                getChangeClass(change) {
                    if (change === null || change === undefined) return 'change-neutral';
                    if (change > 0) return 'change-positive';
                    if (change < 0) return 'change-negative';
                    return 'change-neutral';
                },
                async loadData() {
                    this.loading = true;
                    this.errorSnackbar = false;

                    try {
                        const response = await fetch(`/api/stocks/matrix?exchange=${this.selectedExchange}`);
                        const result = await response.json();

                        if (result.success) {
                            // Initialize analysis fields for each symbol to ensure reactivity
                            result.data.symbols = result.data.symbols.map(symbol => ({
                                ...symbol,
                                analyzing: false,
                                analysis: null,
                                analysisError: null,
                                fetchingPrice: false
                            }));

                            this.matrixData = result.data;
                            console.log(`‚úÖ Loaded ${result.data.symbols.length} symbols`);
                        } else {
                            throw new Error(result.error || 'Failed to load data');
                        }
                    } catch (error) {
                        console.error('‚ùå Error loading data:', error);
                        this.errorMessage = 'Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu: ' + error.message;
                        this.errorSnackbar = true;
                    } finally {
                        this.loading = false;
                    }
                },

                async loadPrices(forceRefresh = false) {
                    if (!this.matrixData || !this.matrixData.symbols) return;

                    this.loadingPrices = true;
                    const action = forceRefresh ? 'Refreshing' : 'Fetching';
                    console.log(`üí∞ ${action} prices in background...`);
                    // Deduplicate symbols before fetching
                    const uniqueSymbols = [...new Set(this.matrixData.symbols.map(s => s.symbol))];
                    const symbols = uniqueSymbols.join(',');
                    const url = `/api/stocks/prices?symbols=${symbols}${forceRefresh ? '&force=1' : ''}`;

                    try {
                        const response = await fetch(url);
                        const result = await response.json();

                        if (result.success) {
                            // Update prices in matrixData
                            this.matrixData.symbols.forEach(symbol => {
                                const priceInfo = result.data[symbol.symbol];
                                if (priceInfo) {
                                    symbol.price = priceInfo.price;
                                    symbol.changePercent = priceInfo.changePercent;
                                    symbol.priceError = priceInfo.error;
                                }
                            });
                            console.log('‚úÖ Prices updated successfully');
                        }
                    } catch (error) {
                        console.log('‚ö†Ô∏è Could not load prices:', error.message);
                        // Don't show error to user - prices are optional
                    } finally {
                        this.loadingPrices = false;
                    }
                },

                async processRawData() {
                    this.processing = true;
                    try {
                        const response = await fetch('/api/process-raw', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        });
                        const result = await response.json();

                        if (result.success) {
                            console.log('‚úÖ Processed raw.json:', result);
                            await this.loadData();
                        } else {
                            throw new Error(result.message || result.error || 'Failed to process');
                        }
                    } catch (error) {
                        console.error('‚ùå Error processing raw data:', error);
                        this.errorMessage = 'Kh√¥ng th·ªÉ x·ª≠ l√Ω raw.json: ' + error.message;
                        this.errorSnackbar = true;
                    } finally {
                        this.processing = false;
                    }
                },

                // Auto-analysis methods
                async autoAnalyzeAll() {
                    if (!this.matrixData || !this.matrixData.symbols || this.matrixData.symbols.length === 0) {
                        return;
                    }

                    if (this.autoAnalyzing) {
                        console.log('‚ö†Ô∏è Auto-analysis already running, skipping...');
                        return;
                    }

                    this.autoAnalyzing = true;

                    // Priority: VN30 first, then others
                    const vn30Symbols = this.matrixData.symbols.filter(s => s.isVN30);
                    const otherSymbols = this.matrixData.symbols.filter(s => !s.isVN30);
                    const sortedSymbols = [...vn30Symbols, ...otherSymbols];

                    this.analyzingProgress = {
                        completed: 0,
                        total: sortedSymbols.length
                    };

                    console.log(`üöÄ Auto-analyzing ${sortedSymbols.length} symbols (${vn30Symbols.length} VN30 priority)...`);
                    console.log(`‚è±Ô∏è Sequential mode: 2s delay between requests (~${Math.ceil(sortedSymbols.length * 2 / 60)} minutes total)`);

                    // Process sequentially with delay
                    await this.analyzeBatch(sortedSymbols);

                    this.autoAnalyzing = false;
                    console.log(`‚úÖ Completed auto-analysis: ${this.analyzingProgress.completed}/${this.analyzingProgress.total}`);
                },

                async analyzeBatch(symbols) {
                    // Sequential processing with 2s delay to avoid rate limiting
                    for (let i = 0; i < symbols.length; i++) {
                        const item = symbols[i];

                        try {
                            await this.analyzeSymbolSilent(item);
                            this.analyzingProgress.completed++;
                        } catch (err) {
                            console.error(`‚ùå Error analyzing ${item.symbol}:`, err);
                            this.analyzingProgress.completed++;
                        }

                        // Add 2s delay between requests (except for the last one)
                        if (i < symbols.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 2000));
                        }
                    }
                },

                async analyzeSymbolSilent(item) {
                    if (item.analyzing || item.analysis) return; // Skip if already analyzing or analyzed

                    item.analyzing = true;
                    item.analysisError = null;

                    try {
                        const response = await fetch(`/api/analyze/${item.symbol}`);
                        const result = await response.json();

                        if (result.success) {
                            Object.assign(item, {
                                ...item,
                                analysis: result.data,
                                analyzing: false,
                                analysisError: null
                            });
                            console.log(`‚úÖ [${this.analyzingProgress.completed + 1}/${this.analyzingProgress.total}] ${item.symbol}: ${result.data.recommendation}`);;
                        } else {
                            item.analysisError = result.error || 'Analysis failed';
                            item.analyzing = false;
                        }
                    } catch (error) {
                        item.analysisError = error.message;
                        item.analyzing = false;
                    }
                },

                // Manual price fetch (from button click)
                async fetchPrice(item) {
                    if (item.fetchingPrice) return;

                    item.fetchingPrice = true;

                    try {
                        console.log(`üí∞ Fetching price for ${item.symbol}...`);
                        const response = await fetch(`/api/stocks/prices?symbols=${item.symbol}&force=1`);
                        const result = await response.json();

                        if (result.success && result.data[item.symbol]) {
                            const priceInfo = result.data[item.symbol];
                            item.price = priceInfo.price;
                            item.changePercent = priceInfo.changePercent;
                            item.priceError = priceInfo.error;
                            console.log(`‚úÖ Price updated for ${item.symbol}: ${priceInfo.price}`);
                        } else {
                            item.priceError = 'Failed to fetch price';
                            console.error(`‚ùå Price fetch failed for ${item.symbol}`);
                        }
                    } catch (error) {
                        item.priceError = error.message;
                        console.error(`‚ùå Error fetching price for ${item.symbol}:`, error);
                    } finally {
                        item.fetchingPrice = false;
                    }
                },

                // Color helpers - VN Stock Market Standard
                getTierColor(tier) {
                    const colors = {
                        'S': 'purple',           // üü£ TƒÉng tr·∫ßn - Xu·∫•t s·∫Øc
                        'A': 'green',            // üü¢ TƒÉng - R·∫•t t·ªët
                        'B': 'yellow-darken-2',  // üü° Tham chi·∫øu - T·ªët
                        'C': 'orange',           // üü† Nh·∫π gi·∫£m - Trung b√¨nh
                        'D': 'red',              // üî¥ Gi·∫£m - K√©m
                        'E': 'cyan',             // üîµ Gi·∫£m nhi·ªÅu - R·∫•t k√©m
                        'F': 'cyan-darken-2'     // üîµ Gi·∫£m s√†n - Th·∫•t b·∫°i
                    };
                    return colors[tier] || 'grey';
                },

                getStatusColor(status) {
                    const colors = {
                        'EXCELLENT': 'success',
                        'GOOD': 'green',
                        'ACCEPTABLE': 'blue',
                        'WARNING': 'orange',
                        'POOR': 'error',
                        'NA': 'grey'
                    };
                    return colors[status] || 'grey';
                },

                getStatusIcon(status) {
                    const icons = {
                        'EXCELLENT': 'üî•',
                        'GOOD': '‚úÖ',
                        'ACCEPTABLE': '‚ûï',
                        'WARNING': '‚ö†Ô∏è',
                        'POOR': '‚ùå',
                        'NA': '‚ö™'
                    };
                    return icons[status] || '-';
                },

                getScenarioIcon(scenario) {
                    const icons = {
                        'STRONG_UPTREND': 'üöÄ',
                        'BREAKOUT_SOON': '‚ö°',
                        'UPTREND_CONSOLIDATION': 'üìà',
                        'SIDEWAY': '‚ÜîÔ∏è',
                        'DOWNTREND_WARNING': '‚ö†Ô∏è',
                        'STRONG_DOWNTREND': 'üìâ'
                    };
                    return icons[scenario] || '?';
                },

                getRecommendationColor(recommendation) {
                    if (!recommendation) return '#999';
                    if (recommendation.includes('MUA')) return '#4CAF50';
                    if (recommendation.includes('B√ÅN')) return '#F44336';
                    return '#FFA726';
                },

                getSignalColor(signal) {
                    const colors = {
                        'BUY': 'success',
                        'HOLD': 'warning',
                        'SELL': 'error'
                    };
                    return colors[signal] || 'grey';
                },

                getWarningColor(level) {
                    const colors = {
                        'HIGH': 'error',
                        'MEDIUM': 'warning',
                        'LOW': 'success'
                    };
                    return colors[level] || 'grey';
                },

                getPriceButtonTooltip(item) {
                    if (item.fetchingPrice) return 'ƒêang l·∫•y gi√°...';
                    if (item.price) return 'C·∫≠p nh·∫≠t gi√°';
                    return 'L·∫•y gi√°';
                }
            },
        });

        app.use(vuetify).mount('#app');
    </script>
</body>

</html>